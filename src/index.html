<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaNexus – Global Pharma City Network</title>
    <link rel="stylesheet" href="./styles/0styles.css" />
    <link rel="stylesheet" href="./styles/0navbar.css" />
    <link rel="stylesheet" href="./styles/0home.css" />
    <link rel="stylesheet" href="./styles/0intro.css" />
    <link rel="stylesheet" href="./styles/1map1.css" />
    <link rel="stylesheet" href="./styles/bubble_new.css" />
    <link rel="stylesheet" href="./styles/summary_bubble.css" />
    <link rel="stylesheet" href="./styles/3company.css" />
    <link rel="stylesheet" href="./styles/4styleHu.css" />
    <link rel="stylesheet" href="./styles/0team.css" />
    <link rel="stylesheet" href="./styles/DataReference.css">
    <link rel="stylesheet" href="./styles/transition.css">
    <link rel="stylesheet" href="./styles/0.css">

    <!-- Mapbox CDN -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet" />
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
</head>

<body>
    <header class="navbar">
        <div class="logo">PharmaNexus</div>
        <div class="menu-toggle">☰</div>
        <div class="sidebar" id="sidebar">
            <a href="#home">Home</a>
            <a href="#pharma-page-1">Introduction</a>
            <a href="#section3">Map1</a>
            <a href="#section5">Map2</a>
            <a href="#section7">Map3</a>
            <a href="#section8">Map4</a>
            <a href="#team">Team</a>
            <a href="#data_reference">About</a>
        </div>
    </header>

    <main>
        <!-- 封面页！！ -->
        <section class="hero" id="home">
            <div class="hero-wrapper">
                <div class="hero-text">
                    <h1>
                        <span id="typed-line1">Connecting Cities,</span><br>
                        <span id="typed-line2">Through Pharmaceutical.</span>
                    </h1>
                    <p>
                        Revealing the global pharmaceutical network through dynamic visualizations of city connections,
                        trade structures, and spatial complexity.
                    </p>
                </div>
                <div class="hero-3d">
                    <iframe src='https://my.spline.design/aheadpill-ZYVJSqnWfJ0Wzf8LNnxBUetX/' frameborder='0'
                        width='100%' height='100%'></iframe>
                    <div class="spline-cover"></div>
                </div>
            </div>
        </section>

        <!-- 第二块intro的切入 -->
        <!-- Page 2: Pharma Global Importance & Model Rationale -->
        <section class="pharma-section gradient-bg top-padded" id="pharma-page-1">
            <div class="pharma-flex two-column">
                <div class="pharma-left">
                    <h1 class="fade-slide page-title">Why Pharma Matters</h1>
                    <div class="intro-lead fade-slide delay-1">
                        <p class="lead-line">Every day, millions rely on pharmaceuticals —</p>
                        <p class="lead-line emphasis">not just for healing, but for surviving.</p>
                        <p class="lead-line delay-2">From the eradication of <strong>smallpox</strong> to the fight
                            against <strong>COVID-19</strong>,</p>
                        <p class="lead-line delay-3">the pharmaceutical industry has quietly powered <strong>global
                                health</strong>.</p>
                        <p class="lead-line delay-4">Its contribution is not just economic — it's existential.</p>
                    </div>
                </div>
                <div class="pharma-right fade-slide delay-5">
                    <div class="pharma-stats-grid">
                        <div class="stat-item zoom-in" data-value="1.3" data-suffix="T">$0T<br><span>Annual
                                Revenue</span></div>
                        <div class="stat-item zoom-in delay-1" data-value="3" data-suffix="%">0%<br><span>Global GDP
                                Share</span></div>
                        <div class="stat-item zoom-in delay-2" data-value="15" data-suffix="%">0%<br><span>R&D
                                Reinvestment</span></div>
                        <div class="stat-item zoom-in delay-3" data-value="5" data-suffix="M">0M<br><span>Jobs
                                Worldwide</span></div>
                        <div class="stat-item zoom-in delay-4" data-value="2.1" data-suffix="%">0%<br><span>US Pharma
                                Spending</span></div>
                        <div class="stat-item zoom-in delay-5" data-value="100" data-suffix="B">0B<br><span>Vaccine
                                Doses / Year</span></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Page 2 – Left Image, Right Text -->
        <section class="pharma-section gradient-bg center-vertical" id="pharma-intro-2">
            <div class="pharma-flex two-column">
                <div class="pharma-left">
                    <img src="./img/woman-shrugging.png" alt="woman-shrugging" class="floating-img" />
                </div>
                <div class="pharma-right fade-slide">
                    <div class="text-block">
                        <h2 class="section-title">But What Lies Beneath?</h2>
                        <div class="section-text">
                            <p class="fade-slide delay-1">Despite its massive scale, the pharmaceutical industry's inner
                                geography remains largely unknown.</p>
                            <p class="fade-slide delay-2">Where are its decision-making cores? Which cities produce,
                                innovate, or distribute? How are these hubs linked?</p>
                            <p class="fade-slide delay-3">COVID-19 exposed the system's fragility — fragmented supply
                                chains, sudden shortages, and critical dependencies.</p>
                            <p class="fade-slide delay-4">To build resilience, we must first uncover its <strong>spatial
                                    architecture</strong>.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Page 3 – Project Logic & Module Overview -->
        <section class="pharma-section gradient-bg center-vertical" id="pharma-intro-3">
            <div class="pharma-flex two-column">
                <!-- 左侧文字内容 -->
                <div class="pharma-left fade-slide">
                    <div class="text-block">
                        <h2 class="section-title">From Trade to Control, Towards Resilience</h2>
                        <div class="section-text">
                            <p class="fade-slide delay-1">
                                Our project unpacks the global pharmaceutical system by progressing from
                                <strong>macro-level trade patterns</strong> to the <strong>micro-dynamics of control and
                                    resilience</strong>.
                            </p>
                            <p class="fade-slide delay-2">
                                We begin with analysing international trade structures, then map out
                                <strong>city-level functional roles</strong>, uncover <strong>corporate control
                                    hierarchies</strong>,
                                and finally evaluate <strong>systemic resilience</strong> through spatial metrics.
                            </p>
                            <p class="fade-slide delay-3">
                                These four modules build a layered understanding of how pharmaceutical
                                power and vulnerability are distributed across the urban network.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- 右侧模块展示 -->
                <div class="pharma-right fade-slide delay-3">
                    <div class="module-grid">
                        <div class="module-card">Global Pharma Trade</div>
                        <div class="module-card">City Functions in the Global Pharma Network</div>
                        <div class="module-card">Global Pharmaceutical Control Network</div>
                        <div class="module-card">Resilience & Comparison</div>
                    </div>
                </div>

            </div>
            <div id="MapBegin">↓ Scroll down to start exploring the map ↓</div>
        </section>

        <!-- Map1 -->
        <section class="Section3" id="section3">
            <!-- 这个是顶上的文字部分 -->
            <div class="section-header">
                <h2 class="section-header-animate">
                    Here we show the trade data of the
                    <span class="highlight">pharmaceutical industry</span> across countries,
                    using an <span class="highlight">interactive map</span> and corresponding legend to interpret the
                    <span class="highlight">trade volume</span> distribution.
                </h2>
            </div>

            <!-- 这里是主体模块 123 -->
            <div class="map-legend-container">
                <!-- 左中：上部地图，下部切换 -->
                <div class="middle">
                    <div id="map1">
                        <div class="toggle-container">
                            <div class="labels">
                                <span>Total Trade</span>
                                <span>Import</span>
                                <span>Export</span>
                            </div>
                            <div class="switch">
                                <input type="range" min="0" max="2" value="0" id="projectionToggle">
                                <div class="track"></div>
                                <div class="thumb"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右侧：图表区 -->
                <div class="chart">
                    <div class="rank">
                        <p>Ranking (Total trade)</p>
                        <div class="treecontent">
                            <svg id="d3-treemap" width="300" height="300"></svg>
                        </div>
                    </div>
                    <div class="pie">
                        <p class="pie-chart-title">Global Import / Export</p>
                        <div class="piecontent"></div>
                        <div class="pie-legend">
                            <div><span class="dot import-dot"></span> Import</div>
                            <div><span class="dot export-dot"></span> Export</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 第一张图的conclusion(map12过渡) -->
        <section class="pharma-conclusion-section" id="conclusion_map1">
            <div class="pharma-conclusion-inner fade-slide">
                <h2 class="conclusion-title">Trade Patterns, Power Clues</h2>
                <div class="conclusion-paragraphs">
                    <p>Our maps reveal clear patterns: the U.S. leads in imports, while Germany and Switzerland dominate
                        exports.</p>
                    <p>Some countries, like Belgium and Ireland, show balance; others, like China and the UK, lean
                        toward consumption.</p>
                    <p>But trade flows alone don't explain control. What follows digs deeper into
                        <strong>ownership</strong>, <strong>organization</strong>, and <strong>urban function</strong>.
                    </p>
                </div>
                <a href="#section5" class="explore-button">Explore the Urban Structure ↓</a>
            </div>
        </section>


        <!-- Map2 -->
        <section class="section5" id="section5">
            <div class="main-content">
                <div class="dashboard-scroll-wrapper" id="dashboardWrapper">
                    <div class="dashboard">
                        <div class="map-container" id="mapbubble"></div>

                        <div id="border-legend">
                            <div class="legend-title">Legend</div>
                            <div class="legend-item">
                                <svg class="legend-icon" viewBox="0 0 20 20">
                                    <circle cx="10" cy="10" r="8" fill="#f0f0f0" stroke="#2980b9" stroke-width="2" />
                                </svg>
                                <span class="legend-label">Single-function</span>
                            </div>
                            <div class="legend-item">
                                <svg class="legend-icon" viewBox="0 0 20 20">
                                    <circle cx="10" cy="10" r="8" fill="#f0f0f0" stroke="#ddd" stroke-width="2" />
                                </svg>
                                <span class="legend-label">Multi-functional</span>
                            </div>
                        </div>

                        <div class="right-panel" id="rightPanel">
                            <div class="info-panel" id="infoPanel">
                                <div class="intro-text" id="defaultMessage">
                                    <h4>Roles and Functions of Cities <br> in the Global Pharma Network</h4>
                                    <p>
                                        This platform visualizes the <strong>spatial organization</strong> of the global
                                        pharmaceutical
                                        industry by mapping cities based on their <strong>functional roles</strong>.
                                    </p>
                                    <ul>
                                        <li><strong>Bubble Size</strong>: Number of pharmaceutical companies</li>
                                        <li><strong>Bubble Color</strong>: Dominant function type (e.g., R&D,
                                            Manufacturing)</li>
                                    </ul>
                                    <p><strong>Zoom-level sensitivity:</strong></p>
                                    <ul>
                                        <li><strong>Zoomed out (global view):</strong> Only the top city per country is
                                            shown.(Click to fly to the city)</li>
                                        <li><strong>Zoomed in (local view):</strong> More cities are revealed.</li>
                                    </ul>
                                </div>

                                <div id="cityDetails" style="display:none">
                                    <div id="cityHeader" style="font-weight: bold;"></div>
                                    <div class="city-info-grid" id="cityInfoGrid"></div>
                                    <canvas id="donutChart" width="130" height="130"
                                        style="margin:auto; display:block;"></canvas>
                                    <button id="backButton">← Back to Overview</button>
                                </div>
                            </div>

                            <div class="filters" id="filter-panel">
                                <h4>Function Filters & Legend</h4>
                                <div id="functionFilters" class="checkbox-grid">
                                    <label><input type="checkbox" value="R&D" checked><span class="legend-box"
                                            style="background-color:#1E0F75;"></span> R&D</label>
                                    <label><input type="checkbox" value="Manufacturing" checked><span class="legend-box"
                                            style="background-color:#1c1dab;"></span> Manufacturing</label>
                                    <label><input type="checkbox" value="Packaging" checked><span class="legend-box"
                                            style="background-color:#BF8CE1;"></span> Packaging</label>
                                    <label><input type="checkbox" value="Wholesale" checked><span class="legend-box"
                                            style="background-color:#E893C5;"></span> Wholesale</label>
                                    <label><input type="checkbox" value="Retail/Medical" checked><span
                                            class="legend-box" style="background-color:#F57F7F;"></span>
                                        Retail/Medical</label>
                                    <label><input type="checkbox" value="API" checked><span class="legend-box"
                                            style="background-color:#ADC6E5;"></span> API</label>
                                    <label><input type="checkbox" value="Support/Other" checked><span class="legend-box"
                                            style="background-color:#CBD8E8;"></span> Support/Other</label>
                                    <label><input type="checkbox" value="Unclassified" checked><span class="legend-box"
                                            style="background-color:#C4C4C4;"></span> Unclassified</label>
                                </div>
                                <div style="margin-top:12px;">
                                    <label>Min Company Count: <input type="number" id="minCompanyCount" value="1"
                                            min="0"></label>
                                </div>
                                <p>Type in the number and enter to search</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="charts-wrapper">
                    <button class="toggle-btn" id="toggleChartsBtn">▲ Show Charts</button>
                    <div class="charts-background collapsed" id="chartsBackground">
                        <section class="charts collapsed" id="chartsSection">
                            <div class="chart-box" id="barChart">
                                <h4>Top Pharma Function Cities</h4>
                                <div class="slider-container">
                                    <label for="topCityLimit"></label>
                                    <div class="slider-wrapper">
                                        <input type="range" id="topCityLimit" min="5" max="20" value="10">
                                        <span id="topCityValue">10</span>
                                    </div>
                                </div>
                                <canvas id="stackedBarChart"></canvas>
                            </div>
                            <div class="chart-box" id="scatterPlot">
                                <h4>Function Count vs. Entropy</h4>
                                <p>
                                    Click on the points to see city specifics
                                </p>
                                <canvas id="scatterCanvas" width="320" height="200"></canvas>
                            </div>
                        </section>
                    </div>

                </div>
            </div>
        </section>

        <!-- map2summary -->
        <section id="bubble_summary">
            <div class="pharma-horizontal-wrapper">
                <div class="pharma-function-bar wheel-selector">
                    <h2>Function Types</h2>
                    <p class="wheel-hint">Scroll or click to explore function-specific city patterns.</p>
                    <div class="wheel-wrapper">
                        <!-- <div class="center-indicator"></div> -->
                        <div class="wheel-container">
                            <div class="wheel-item" data-function="rd">R&D</div>
                            <div class="wheel-item" data-function="raw">API</div>
                            <div class="wheel-item" data-function="manu">Manufacturing</div>
                            <div class="wheel-item" data-function="pack">Packaging</div>
                            <div class="wheel-item" data-function="wholesale">Wholesale</div>
                            <div class="wheel-item" data-function="retail">Retail/Medical</div>
                            <div class="wheel-item" data-function="support">Support/Other</div>
                        </div>
                    </div>
                </div>

                <div class="pharma-main-area">
                    <!-- Matrix Area -->
                    <div class="pharma-matrix-area chart-section">
                        <div class="chart-title-wrapper">
                            <h3 class="chart-title">Dependency vs Contribution</h3>
                        </div>
                        <div class="chart-body">
                            <svg id="fingerprintChart"></svg>
                        </div>
                    </div>

                    <!-- Bubble Area -->
                    <div class="pharma-bubble-area chart-section">
                        <div class="chart-title-wrapper">
                            <h3 class="chart-title">City Role Structure</h3>
                        </div>
                        <div class="chart-body">
                            <div class="chart-scale-wrapper">
                                <svg id="bubbleChart"></svg>
                            </div>
                            <div id="bubbleLegend">
                                <div class="legend-row">
                                    <div class="bubble-shape circle"></div> Multi-functional
                                </div>
                                <div class="legend-row">
                                    <div class="bubble-shape triangle"></div> Single-function
                                </div>
                                <div class="legend-row">
                                    <div class="bubble-shape square"></div> Weakly Diversified
                                </div>
                                <div class="legend-row" style="margin-top: 8px;">Dominance Ratio</div>
                                <div class="color-bar"></div>
                                <div class="legend-row" style="justify-content: space-between;">
                                    <span>0</span><span>1</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pharma-summary-insights" id="pharma-summary-insights">
                    <h3>STRUCTURAL INSIGHTS</h3>
                    <ul>
                        <li><strong>Dual Specialization:</strong> Only a few cities combine both high specialization and
                            large
                            scale.</li>
                        <li><strong>North American Pattern:</strong> Manufacturing dominates across U.S. cities, while
                            R&D is
                            limited to a few hubs.</li>
                        <li><strong>Regional Dominance:</strong> Europe leads in Wholesale, whereas Asia shows high
                            functional
                            heterogeneity.</li>
                        <li><strong>Diversity vs Dominance:</strong> Cities tend to trade off internal specialization
                            for global
                            influence — both rarely coexist.</li>
                        <li><strong>Functional Geography:</strong> Multifunctional cities are more common in Europe and
                            Asia;
                            the U.S. has more specialized hubs.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- map23过渡 -->
        <section class="pharma-conclusion-section" id="conclusion_control_network">
            <div class="pharma-conclusion-inner fade-slide">
                <h2 class="conclusion-title">From Trade Patterns to Corporate Power</h2>
                <div class="conclusion-paragraphs">
                    <p>Over the previous sections we've mapped global pharmaceutical trade flows and functional
                        clusters. Now we shift focus to the <span class="highlight">ownership control network</span> —
                        the equity links between headquarters and subsidiaries that govern city hierarchies and spatial
                        power.</p>
                    <p>Click the “Explore” button below to dive into the interactive Control Network map and uncover
                        control radii, power‑hub cities, and cross‑border paths for the Top‑20 pharma companies.</p>
                </div>
                <a href="#section7" class="explore-button">Explore the Control Network ↓</a>
            </div>
        </section>

        <!-- map3 -->
        <section class="Section7" id="section7">
            <div id="left-position-control">
                <!-- 上半部分国家选择 -->
                <div id="select20top">
                    <div class="filter-card">
                        <div class="filter-card-title">Control Network Filters</div>
                        <div class="highlight-text">
                            <label for="company-selector" class="gradient-label">Select a
                                pharmaceutical company:</label>
                            <select id="company-selector" class="full-width">
                                <option value="" selected disabled>Please select a company</option>
                                <option value="ALL">Top 20 Companies</option>
                            </select>
                        </div>

                        <div class="filter-control">
                            <label class="filter-label">Ownership Filter:</label>
                            <input type="range" id="ownership-slider" min="0" max="100" value="50" step="10">
                            <div class="range-value"><span id="ownership-value">50</span>% and above</div>
                        </div>
                    </div>
                </div>
                <!-- 下半部分数据展示 -->
                <div id="FoldedInformationBar">
                    <!-- Network Overview 折叠控制按钮 -->
                    <button class="panel-toggle-btn">Network Overview</button>
                    <div class="panel-section2">
                        <div class="stats-card">
                            <div class="stat-row">
                                <div class="stat-label">Total Entities:</div>
                                <div class="stat-value" id="total-entities">0</div>
                            </div>
                            <div class="stat-row">
                                <div class="stat-label">HQ Cities:</div>
                                <div class="stat-value" id="hq-count">0</div>
                            </div>
                            <div class="stat-row">
                                <div class="stat-label">Subsidiary Cities:</div>
                                <div class="stat-value" id="sub-count">0</div>
                            </div>
                            <div class="stat-row">
                                <div class="stat-label">Average Ownership:</div>
                                <div class="stat-value" id="avg-ownership">0%</div>
                            </div>
                            <div class="stat-row">
                                <div class="stat-label">International Control Ratio:</div>
                                <div class="stat-value" id="intl-ratio">0%</div>
                            </div>
                            <div class="stat-row">
                                <div class="stat-label">Total Revenue:</div>
                                <div class="stat-value" id="total-assets">$0M</div>
                            </div>
                        </div>
                    </div>

                    <!-- Control Hierarchy 折叠控制按钮 -->
                    <button class="panel-toggle-btn">Control Hierarchy</button>
                    <div class="panel-section2">
                        <div class="hierarchy-diagram" id="hierarchy-viz">
                            <div class="hierarchy-node hq-node">1 HQ City</div>
                            <div class="hierarchy-connections">
                                <div class="connection-line center"></div>
                            </div>
                            <div class="hierarchy-level">
                                <div class="hierarchy-node sub-node">0 Subsidiary Cities</div>
                            </div>
                            <div class="hierarchy-stats">
                                <div class="hierarchy-stat">
                                    <div class="stat-label">Full Control</div>
                                    <div class="stat-value">0</div>
                                </div>
                                <div class="hierarchy-stat">
                                    <div class="stat-label">International Control</div>
                                    <div class="stat-value">0</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Power Hub Cities 折叠控制按钮 -->
                    <button class="panel-toggle-btn">Power Hub Cities</button>
                    <div class="panel-section2">
                        <div class="power-centers" id="power-centers-list">
                            Please select a company first!
                        </div>
                    </div>
                </div>
            </div>
            <div id="right-position-control">
                <div id="map-container">
                    <div id="mapCompany">
                        <div id="loading-indicator" style="display: none;">
                            <div class="loader"></div>
                            <div class="loading-text">Loading data...</div>
                        </div>
                    </div>

                    <div class="map-controls">
                        <button id="zoom-fit" title="Fit All Data"><i class="fas fa-expand"></i></button>
                        <button id="zoom-hq" title="Focus on HQ"><i class="fas fa-building"></i></button>
                        <button id="toggle-labels" title="Toggle Labels"><i class="fas fa-tag"></i></button>
                        <button id="help-btn" title="Help & Instructions"><i
                                class="fas fa-question-circle"></i></button>
                    </div>

                    <div id="map-legend">
                        <h3>Legend</h3>
                        <div class="legend-section">
                            <h4>Node Types</h4>
                            <div class="legend-item">
                                <span class="color-dot hq-color"></span>
                                <span>HQ City</span>
                            </div>
                            <div class="legend-item">
                                <span class="color-dot sub-color"></span>
                                <span>Subsidiary City</span>
                            </div>
                        </div>

                        <!-- 添加连接线说明 -->
                        <div class="legend-section">
                            <h4>Connections</h4>
                            <div class="legend-item">
                                <div class="connection-line-sample"></div>
                                Control Relationship
                            </div>
                        </div>

                        <div class="legend-section">
                            <h4>Continent Colors</h4>
                            <div class="legend-colors">
                                <div class="color-item">
                                    <span class="color-block na-color"></span>
                                    <span>North America</span>
                                </div>
                                <div class="color-item">
                                    <span class="color-block eu-color"></span>
                                    <span>Europe</span>
                                </div>
                                <div class="color-item">
                                    <span class="color-block as-color"></span>
                                    <span>Asia</span>
                                </div>
                                <div class="color-item">
                                    <span class="color-block af-color"></span>
                                    <span>Africa</span>
                                </div>
                                <div class="color-item">
                                    <span class="color-block sa-color"></span>
                                    <span>South America</span>
                                </div>
                                <div class="color-item">
                                    <span class="color-block oc-color"></span>
                                    <span>Oceania</span>
                                </div>
                            </div>
                        </div>

                        <div class="legend-section">
                            <h4>Data Notes</h4>
                            <div class="legend-item">
                                <span>*</span>
                                <span>Estimated</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="slide-tab">Hover me</div>
            <div id="information_area">
                <div class="panel-header">
                    <h2>Control Relationship Details</h2>
                    <div class="panel-actions">
                        <button id="toggle-analysis" class="toggle-btn" title="Toggle Analysis Charts">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                    </div>
                </div>
                <div id="details-panel">
                    <div id="panel-resizer"></div>
                    <div class="panel-content-wrapper">
                        <!-- 1分析图表区域 -->
                        <div class="panel-content active" id="analysis-content">
                            <div class="analysis-section">
                                <h3>Network Density Analysis</h3>
                                <div id="network-density-chart" class="chart-container">
                                    <canvas id="density-chart"></canvas>
                                </div>
                            </div>

                            <div class="analysis-section">
                                <h3>Cross-Border Control Paths</h3>
                                <div id="control-distance-chart" class="chart-container">
                                    <canvas id="distance-chart"></canvas>
                                </div>
                            </div>

                            <div class="analysis-section">
                                <h3>Power Hub Cities</h3>
                                <div id="power-hub-chart" class="chart-container">
                                    <canvas id="hub-chart"></canvas>
                                </div>
                            </div>

                        </div>
                        <!-- 2子公司表格区域 -->
                        <div class="panel-content" id="subsidiaries-content">
                            <div class="filter-bar">
                                <div class="search-box">
                                    <input type="text" id="subsidiary-search" placeholder="Search subsidiaries...">
                                    <i class="fas fa-search"></i>
                                </div>
                                <div class="filter-dropdown">
                                    <select id="continent-filter">
                                        <option value="all">All Continents</option>
                                        <option value="NA">North America</option>
                                        <option value="EU">Europe</option>
                                        <option value="AS">Asia</option>
                                        <option value="AF">Africa</option>
                                        <option value="SA">South America</option>
                                        <option value="OC">Oceania</option>
                                    </select>
                                </div>
                                <div class="sort-controls">
                                    <button class="sort-btn active" data-sort="ownership">Ownership</button>
                                    <button class="sort-btn" data-sort="assets">Assets</button>
                                </div>
                            </div>

                            <div class="table-container">
                                <table id="subsidiaries-table">
                                    <thead>
                                        <tr>
                                            <th>Subsidiary Name</th>
                                            <th>City</th>
                                            <th>Country</th>
                                            <th>Ownership</th>
                                            <th>NACE Code (Function)</th>
                                            <th>Assets</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="help-modal" class="hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>PharmaNexus Global Pharmaceutical Control Network</h2>
                        <button id="help-modal-close" class="modal-close">×</button>
                    </div>

                    <div class="help-nav">
                        <div class="nav-item active" data-target="overview">Overview</div>
                        <div class="nav-item" data-target="controls">Control Panel</div>
                        <div class="nav-item" data-target="map">Map View</div>
                        <div class="nav-item" data-target="operations">Usage Guide</div>
                        <div class="nav-item" data-target="data">Data Details</div>
                    </div>


                    <div id="help-modal-body">
                        <!-- 帮助内容将通过JavaScript填充 -->
                    </div>
                </div>
            </div>
            <div id="detail-modal" class="hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="modal-title">Entity Details</h2>
                        <button id="modal-close" class="modal-close">×</button>
                    </div>
                    <div id="modal-body" class="modal-body">
                        <!-- Content will be dynamically populated -->
                    </div>
                </div>
            </div>
        </section>

        <!-- map34过渡 -->
        <section class="pharma-conclusion-section" id="conclusion_resilience">
            <div class="pharma-conclusion-inner fade-slide">
                <h2 class="conclusion-title">After All This... A Final Question:</h2>
                <div class="conclusion-paragraphs">
                    <p>Why have some cities managed to occupy the core of the network for so long?</p>
                    <p>Which cities are likely to rise as new hubs?</p>
                    <p>Perhaps the <span class="highlight">Urban Resilience Index</span> can answer your questions.</p>
                </div>
                <a href="#map4methodology" class="explore-button">Explore Urban Resilience ↓</a>
            </div>
        </section>

        <section id="map4methodology" class="flat-section">
            <div id="leftmap4methodology">
                <div class="flat-intro">
                    <h2 class="flat-title">Urban Resilience Index</h2>
                    <p class="flat-lead">
                        The Urban Resilience Index (URI) evaluates how well a city can respond to and recover from
                        shocks
                        like
                        pandemics, climate change, and economic disruption.
                    </p>
                    <ul class="flat-list">
                        <li><strong>FD:</strong> Functional Diversity</li>
                        <li><strong>OR:</strong> Operating Revenue (normalized to 0-5)</li>
                        <li><strong>ESG:</strong> Environmental, Social, and Governance Index</li>
                    </ul>
                </div>

                <div class="flat-esg">
                    <h3 class="flat-subtitle">What is ESG Index?</h3>
                    <p>ESG is a global standard to assess corporate sustainability:</p>
                    <ul class="flat-list">
                        <li><strong>Environmental (E):</strong> Green performance and pollution control</li>
                        <li><strong>Social (S):</strong> Equity, labor care, community impact</li>
                        <li><strong>Governance (G):</strong> Transparency and institutional soundness</li>
                    </ul>
                </div>
            </div>

            <div class="flat-categories">
                <div class="category-block green">
                    <h4>Environmentally Oriented City</h4>
                    <p>Eco-efficient, climate-adaptive, and low-emission.</p>
                </div>
                <div class="category-block blue">
                    <h4>Socially Oriented City</h4>
                    <p>Trusted, inclusive, and strong in community engagement.</p>
                </div>
                <div class="category-block purple">
                    <h4>Governance-Oriented City</h4>
                    <p>Efficient, responsive, and transparent in crisis response.</p>
                </div>
            </div>
        </section>

        <!-- map4 -->
        <section class="Section8" id="section8">
            <div id="map_re">
                <div id="citySelector">
                    <label for="cityDropdown">Select City:</label>
                    <select id="cityDropdown">
                        <option value="">please select city</option>
                    </select>
                </div>
                <div id="legend">
                    <div>
                        <input type="checkbox" data-cluster="2" checked>
                        <span class="color-box" style="background-color: #3785D8;"></span>
                        <span class="label-text">Environmentally Oriented City</span>
                    </div>
                    <div>
                        <input type="checkbox" data-cluster="1" checked>
                        <span class="color-box" style="background-color: #A692E8;"></span>
                        <span class="label-text">Socially Oriented City</span>
                    </div>
                    <div>
                        <input type="checkbox" data-cluster="0" checked>
                        <span class="color-box" style="background-color: #F3A6A1;"></span>
                        <span class="label-text">Governance-oriented City</span>
                    </div>
                </div>
            </div>

            <div class="menu">
                <div id="radar">
                    <canvas id="radarChart" width="300" height="300"></canvas>
                </div>
<div id="rank" style="position: relative;">

  <div class="ranking-controls" id="rankingControls">
    <label for="rankingSelect">Sort by:</label>
    <select id="rankingSelect">
      <option value="resilienceIndex">Resilience Index</option>
      <option value="MSCIoverall">ESG Index</option>
      <option value="functionalDiversity">Functional Diversity</option>
      <option value="operatingRevenue">Operating Revenue</option>
    </select>
  </div>
  <canvas id="rankingChart" ...></canvas>
</div>

            </div>

            <button id="gotoComparison" style="
                       position: absolute; top: 100px; right: 500px; z-index: 9999;
                       
                       padding: 5px 10px; cursor: pointer;">Enter the Comparison Model
            </button>
        </section>

        <section class="Section8-Comparison" style="display: none;">
            <div id="mapContainer">
                <div class="mapPanel">
                    <div class="selectorBox">
                        <label for="cityDropdownA">City A:</label>
                        <select id="cityDropdownA">
                            <option value="">Select</option>
                        </select>
                    </div>

                    <div id="map11" class="mapBox"></div>
                </div>

                <div class="centerPanel">
                    <div id="compareInfoText" class="info-box">
                        <h3>City Comparison Mode</h3>
                        <p>
                            This page allows comparison of ESG indicators between two cities.<br>
                            To return to single-city view, please click the button below.
                        </p>
                    </div>

                    <button id="backButtonHu">Return to Single Map</button>
                    <div id="radarContainer">
                        <canvas id="comparisonRadarChart" width="300" height="300"></canvas>
                    </div>
                    <div id="legendcon">
                        <div><span style="background-color: #3785D8;"></span> Environmentally Oriented City</div>
                        <div><span style="background-color: #A692E8;"></span> Socially Oriented City</div>
                        <div><span style="background-color: #F3A6A1;"></span> Governance-oriented City</div>
                    </div>
                </div>

                <div class="mapPanel">
                    <div class="selectorBox selectorB">
                        <label for="cityDropdownB">City B:</label>
                        <select id="cityDropdownB">
                            <option value="">Select</option>
                        </select>
                    </div>
                    <div id="map22" class="mapBox"></div>
                </div>
            </div>
        </section>

        <!-- 极速版尝试 -->
        <section id="section8-new-comparison" class="section-comparison">
            <div class="comparison-container">
                <!-- 左地图 -->
                <div class="map-side">
                    <!-- <label for="citySelectorLeft">City A:</label> -->
                    <select id="citySelectorLeft">
                        <option value="">Select City A</option>
                    </select>
                    <div id="mapleftoverview"></div>
                    <div id="mapLeft" class="comparison-map"></div>
                </div>

                <!-- 中间对抗横条 -->
                <!-- 对抗横条区域 -->
                <div class="comparison-bars-wrapper">
                    <h2 class="comparison-title">City Resilience Comparison</h2>
                    <div class="comparison-bars" id="comparisonBars"></div>
                </div>


                <!-- 右地图 -->
                <div class="map-side">
                    <!-- <label for="citySelectorRight">City B:</label> -->
                    <select id="citySelectorRight">
                        <option value="">Select City B</option>
                    </select>
                    <div id="maprightoverview"></div>
                    <div id="mapRight" class="comparison-map"></div>
                </div>
            </div>
        </section>

        <!-- TeamIntro -->
        <section class="Team" id="team">
            <h1><strong>Team</strong></h1>
            <div class="TeamIntro">
                <div id="teampic">
                    <div class="member">
                        <div class="member1pic"></div>
                        <p>Borui Wang</p>
                    </div>
                    <div class="member">
                        <div class="member2pic"></div>
                        <p>Xinyue Hu</p>
                    </div>
                    <div class="member">
                        <div class="member3pic"></div>
                        <p>Yifan Wu</p>
                    </div>
                    <div class="member">
                        <div class="member4pic"></div>
                        <p>Yue Qiu</p>
                    </div>
                </div>
                <div id="nametip">
                    <p>Names are arranged alphabetically — order does not reflect hierarchy.</p>
                </div>
            </div>
        </section>

        <!-- data&reference&footer -->
        <section id="data_reference">
            <div class="reference-wrapper fade-slide">
                <h2 class="reference-title">About</h2>

                <div class="reference-block">
                    <h3>Data Sources</h3>
                    <ul class="reference-list">
                        <li><a href="https://comtradeplus.un.org/" target="_blank">UN Comtrade: International Trade
                                Data</a></li>
                        <li><a href="https://www.orbis.bvdinfo.com/" target="_blank">Orbis by Bureau van Dijk: Firm
                                Ownership Data</a></li>
                        <li><a href="https://www.gfdrr.org/" target="_blank">GFDRR: Resilience Indicators</a></li>
                    </ul>
                </div>

                <div class="reference-block">
                    <h3>Academic References</h3>
                    <ul class="reference-list">
                        <li>Krätke, S. (2014). How manufacturing industries connect cities into global urban networks.
                            <i>Global Networks</i>, 14(2), 148–168.
                        </li>
                        <li>Taylor, P.J., Derudder, B. (2016). <i>World City Network: A Global Urban Analysis</i>.
                            Routledge.</li>
                        <li>OECD (2023). Measuring Pharmaceutical Trade. OECD Health Statistics.</li>
                    </ul>
                </div>
            </div>
            <div class="footer-content">
                <p>
                    &copy; 2025 Centre for Advanced Spatial Analysis, University College London
                    |
                    <a href="https://github.com/Van-Wu1/003_Coding_ProgressiveTense" target="_blank">GitHub</a>
                </p>
            </div>
        </section>
    </main>

    <script type="module" src="js/0navbar.js" defer></script>
    <script type="module" src="js/0home.js"></script>
    <script type="module" src="js/0intro.js"></script>
    <script type="module" src="js/1map_imexport.js"></script>
    <script src="./js/bubble_01_copy.js"></script>
    <script src="./js/summary_bubble.js"></script>
    <script src="./js/3company.js"></script>
    <script src="./js/4resilience.js"></script>
    <script src="./js/4comparison.js"></script>
    <script src="./js/methodology.js" defer></script>
    <script src="./js/0.js" defer></script>

</body>

</html>